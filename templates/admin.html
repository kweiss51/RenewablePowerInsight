{% extends "base.html" %}

{% block title %}Admin Dashboard - Energy Blog{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <div class="container">
        <h1>⚙️ Admin Dashboard</h1>
        
        <section class="admin-stats">
            <h2>📊 System Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>📄 Article Files</h3>
                    <p class="stat-number">{{ stats.total_article_files }}</p>
                </div>
                <div class="stat-card">
                    <h3>📝 Blog Post Files</h3>
                    <p class="stat-number">{{ stats.total_post_files }}</p>
                </div>
                <div class="stat-card">
                    <h3>📰 Current Posts</h3>
                    <p class="stat-number">{{ stats.current_posts }}</p>
                </div>
                <div class="stat-card">
                    <h3>⏰ Last Update</h3>
                    <p class="stat-text">{{ stats.last_update[:16] }}</p>
                </div>
            </div>
        </section>
        
        <section class="admin-actions">
            <h2>🔧 Actions</h2>
            <div class="actions-grid">
                <div class="action-card">
                    <h3>🔄 Manual Scrape</h3>
                    <p>Trigger immediate news scraping and blog generation</p>
                    <button id="manual-scrape" class="btn btn-primary">Start Scraping</button>
                    <div id="scrape-status" class="status-message"></div>
                </div>
                
                <div class="action-card">
                    <h3>📊 View API Data</h3>
                    <p>Check the current blog posts data via API</p>
                    <a href="{{ url_for('api_posts') }}" class="btn btn-secondary" target="_blank">View JSON</a>
                </div>
                
                <div class="action-card">
                    <h3>🔍 System Status</h3>
                    <p>Check if all components are working correctly</p>
                    <button id="check-status" class="btn btn-info">Check Status</button>
                    <div id="status-result" class="status-message"></div>
                </div>
            </div>
        </section>
        
        <section class="admin-logs">
            <h2>📋 Recent Activity</h2>
            <div class="logs-container">
                <div id="activity-log">
                    <p>💡 System is running normally</p>
                    <p>⏰ Next scheduled update in ~4 hours</p>
                    <p>🤖 AI blog generation is active</p>
                </div>
            </div>
        </section>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const manualScrapeBtn = document.getElementById('manual-scrape');
    const scrapeStatus = document.getElementById('scrape-status');
    const checkStatusBtn = document.getElementById('check-status');
    const statusResult = document.getElementById('status-result');
    
    manualScrapeBtn.addEventListener('click', function() {
        this.disabled = true;
        this.textContent = '🔄 Scraping...';
        scrapeStatus.innerHTML = '<p class="status-info">Scraping in progress...</p>';
        
        fetch('/api/scrape', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    scrapeStatus.innerHTML = `<p class="status-success">✅ Success! Generated ${data.posts_count} posts</p>`;
                } else {
                    scrapeStatus.innerHTML = `<p class="status-error">❌ Error: ${data.error}</p>`;
                }
            })
            .catch(error => {
                scrapeStatus.innerHTML = `<p class="status-error">❌ Network error: ${error}</p>`;
            })
            .finally(() => {
                manualScrapeBtn.disabled = false;
                manualScrapeBtn.textContent = 'Start Scraping';
                setTimeout(() => location.reload(), 2000);
            });
    });
    
    checkStatusBtn.addEventListener('click', function() {
        this.disabled = true;
        this.textContent = '🔍 Checking...';
        
        fetch('/api/posts')
            .then(response => response.json())
            .then(data => {
                statusResult.innerHTML = `
                    <p class="status-success">✅ API is working</p>
                    <p>Posts available: ${data.count}</p>
                    <p>Last updated: ${data.last_updated.slice(0, 16)}</p>
                `;
            })
            .catch(error => {
                statusResult.innerHTML = `<p class="status-error">❌ API error: ${error}</p>`;
            })
            .finally(() => {
                checkStatusBtn.disabled = false;
                checkStatusBtn.textContent = 'Check Status';
            });
    });
});
</script>
{% endblock %}
